---
import DarkModeBtn from "../buttons/DarkModeBtn.astro";

const links = [
  { id: "welcome", label: "Inicio" },
  { id: "experience", label: "Experiencia" },
  { id: "proyects", label: "Proyectos" },
  { id: "contact", label: "Contacto" },
];
---

<header class="sticky top-0 z-30 backdrop-blur-xl">
  <div class="section-shell">
    <nav
      class="glass-panel subtle-border mt-4 flex w-full flex-col gap-3 px-4 py-3 md:px-6 lg:flex-row lg:items-center"
      id="navBar"
    >
      <div class="flex w-full items-center justify-between gap-3">
        <a href="/" class="flex items-center gap-3">
          <!-- <img
            src="/logo.png"
            class="h-10 rounded-xl border border-[var(--border-color)]"
            alt="Logo Luis"
          /> -->
          <div class="leading-tight">
            <p
              class="text-xs uppercase tracking-[0.12em] text-teal-400 font-semibold"
            >
              Ingeniero informático
            </p>
            <p class="text-base font-bold text-[var(--text-primary)]">
              Luis Araya
            </p>
          </div>
        </a>

        <button
          class="inline-flex h-11 w-11 items-center justify-center rounded-xl border border-[var(--border-color)] lg:hidden"
          id="navToggle"
          aria-label="Abrir menú"
          aria-expanded="false"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-6 w-6 text-[var(--text-primary)]"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="1.8"
              d="M4 7h16M4 12h16M4 17h16"></path>
          </svg>
        </button>
      </div>

      <div
        id="navMenu"
        class="hidden w-full flex-col gap-4 border-t border-[var(--border-color)] pt-4 lg:ml-auto lg:flex lg:w-auto lg:flex-row lg:items-center lg:gap-6 lg:border-0 lg:pt-0"
      >
        <ul class="flex flex-col gap-2 lg:flex-row lg:items-center lg:gap-4">
          {
            links.map((nav) => (
              <li>
                <a class="" data-target={nav.id} href={`#${nav.id}`}>
                  {nav.label}
                </a>
              </li>
            ))
          }
        </ul>
        <div class="flex items-center gap-3 lg:gap-4">
          <a class="btn-ghost" href="#contact">Hablemos</a>
          <div
            class="hidden h-11 w-11 items-center justify-center rounded-full border border-[var(--border-color)] bg-white/5 p-1 lg:flex"
          >
            <DarkModeBtn />
          </div>
        </div>
      </div>
    </nav>
  </div>

  <script is:inline>
    const navToggle = document.getElementById("navToggle");
    const navMenu = document.getElementById("navMenu");
    const navLinks = Array.from(document.querySelectorAll("[data-target]"));

    navToggle?.addEventListener("click", () => {
      const isOpen = navMenu?.classList.toggle("hidden") === false;
      navToggle.setAttribute("aria-expanded", String(isOpen));
    });

    navLinks.forEach((link) => {
      link.addEventListener("click", (event) => {
        event.preventDefault();
        const targetId = link.getAttribute("data-target") || "";
        const target = document.getElementById(targetId);
        if (target) {
          const offset = 90;
          const y =
            target.getBoundingClientRect().top + window.scrollY - offset;
          window.scrollTo({ top: y, behavior: "smooth" });
        }
        if (window.innerWidth < 1024) navMenu?.classList.add("hidden");
      });
    });

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          const id = entry.target.getAttribute("id") || "";
          const link = document.querySelector(`[data-target="${id}"]`);
          if (link) {
            link.classList.toggle("active", entry.isIntersecting);
          }
        });
      },
      { rootMargin: "-40% 0px -40% 0px", threshold: 0.2 }
    );

    navLinks.forEach((link) => {
      const section = document.getElementById(
        link.getAttribute("data-target") || ""
      );
      if (section) observer.observe(section);
    });
  </script>
</header>
